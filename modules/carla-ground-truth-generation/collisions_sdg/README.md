# SDG for collision scenarios

## Overview

For Carla log files that contain collisions between vehicles (actors), the details about the collision can be reported through the use of Collision Detectors provided by Carla. These detectors (sensors) need to be attached to the actor(s) of interest during the time of log creation, so that collision events will be generated and relevant data will be stored in the log, to be queried and reported (See: https://carla.readthedocs.io/en/latest/adv_recorder/#collisions).

The provided SDG script will use the log to ouput all vehicle collisions (filtered for a specific actor, if needed) into a json file. See the output section below for a sample.

## Prerequisites

To check if there are any collisions recorded in a log file, you can use the Carla provided example script "show_recorder_collisions.py" available in the CARLA_ROOT/PythonAPI/examples directory, as follows:

```bash
python show_recorder_collisions.py -f <LOGFILE_PATH>
```

where `<LOGFILE_PATH>` is the path to the CARLA log file

This will print a table of all recorded collisions, and can also be used to find the ID(s) of actor(s) of interest for running SDG data using the provided script.

## SDG generation

Run the script as follows to generate collisions data for all vehicles, as captured in the log:
```bash
python sdg_collisions.py -f <LOGFILE_PATH>
```

Run the script as follows to generate collisions data for a specific vehicle:
```bash
python sdg_collisions.py --id <ACTOR_ID> -f <LOGFILE_PATH>
```
Where `<ACTOR_ID>` is the ID of the Vehcile (Actor) in the Carla log, which may be derived by querying the log (see Prerequisites section)

For a verbose mode, include the '-v' option, which will print the raw collisions data from the log, as reported by Carla.

**Note** 
- The Carla log may contain collisions between vehicles and other types of objects, including static objects in the scene. There may also be repetitions listed across time and pair of vehicles. Such will be filtered out by the provided script in the SDG output.
- The json output will be written into an events.json file in the same directory where the script is run. If there are no collisions reported in the log, then no file will be generated.

## Output JSON

A sample Carla log file can be downloaded from: https://nvidia-my.sharepoint.com/:u:/p/sudeshk/EXuEDvr4Ej5OhxLOj-0_btYB0a9WjlMGkxc4kb6wKbbGBw?e=JTrSQQ

The events.json output file generated by the SDG script for above sample log is as follows:
```json
[
    {
        "event_id": "event_000001",
        "start_time": "1",
        "end_time": "1",
        "category": "collision",
        "event_sub_category": "",
        "objects": [
            "249",
            "257"
        ],
        "event_caption": ""
    },
    {
        "event_id": "event_000002",
        "start_time": "4",
        "end_time": "4",
        "category": "collision",
        "event_sub_category": "",
        "objects": [
            "201",
            "203"
        ],
        "event_caption": ""
    }
]
```